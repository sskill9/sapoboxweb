# Multiple Choice Questions ツール 仕様書（確定版）

## 1. 目的
本ツールは、新人教育における日別理解度テストや、定期的なセキュリティテスト等を目的とした  
**ローカル完結型 Multiple Choice Questions（選択式テスト）ツール**である。

ネットワーク接続やサーバー環境を前提とせず、`file://` での起動を前提とする。  
回答の事前閲覧を防ぐため、**SV（管理者）による採点キー入力方式**を採用する。

---

## 2. 前提条件・制約
- 完全ローカル動作（オフライン可）
- CORS問題回避のため **JSONファイルは使用しない**
- 設問データは **JavaScriptファイル（testpack.js）で定義**
- 結果は **TXTファイルとしてダウンロード出力**
- 対応ブラウザ：Chrome / Edge
- 文字コード：UTF-8

---

## 3. 役割
### 管理者 / SV
- 設問作成
- 採点キー設定（固定）
- 採点実施
- 合否確認

### 受講者
- 受験
- 回答提出
- 採点キー入力は行わない（運用ルール）

---

## 4. 運用フロー（確定）
1. 管理者 / SV が作成ツールで設問を作成し、`testpack.js` を生成
2. 受講者が `index.html` をローカルで開き受験
3. 回答提出後、「SVを呼んでください」画面を表示
4. SVが採点キーを入力し **ENTER** を押す
5. 画面に **合否 + 正解率（小数第1位）** を表示
6. 同時に結果TXTを **ダウンロード形式で出力**

※ 保存先はブラウザ設定に依存し、アクセス権の影響を受けない

---

## 5. 設問形式
- 単一選択（single）
- 複数選択（multi）

### 複数選択の採点ルール
- 正解セットと **完全一致** した場合のみ正解
- 過不足が1つでもあれば不正解

---

## 6. スコア・合否判定
- 正解率 = (正解数 / 問題数) × 100
- 表示形式：**小数第1位まで（四捨五入）**
- 合否判定：正解率 >= 合格ライン（％）

---

## 7. ファイル構成（予定）
- index.html ：受験・採点UI
- testpack.js ：設問データ（暗号化済み正解を含む）
- app.js ：受験・採点ロジック
- crypto.js ：暗号処理
- styles.css ：スタイル

---

## 8. testpack.js の基本方針
- `<script>` 読み込み
- `window.TESTPACK = { ... }` 形式で定義
- 平文の正解は保持しない
- 正解は暗号化済みデータとして保持

※ 詳細フォーマットは次スレッドで定義

---

## 9. 採点キー仕様
- テスト作成時に **固定キー** を設定
- 採点時にSVが入力
- 以下は禁止
  - 画面表示
  - ファイル保存
  - コンソール出力
  - localStorage保存

---

## 10. 結果TXTファイル仕様

### 10.1 ファイル名
```
社員番号_氏名_テスト名_合否_YYYYMMDD-HHMMSS.txt
```

### 10.2 ファイル名サニタイズ
- 禁止文字： \ / : * ? " < > |  
- 上記および改行・タブは `_` に置換

---

### 10.3 TXT内容（共通）
- テスト名
- テストID
- 社員番号
- 氏名
- 受験開始日時（JST）
- 提出日時（JST）
- 所要時間（秒）
- 正解数 / 問題数
- 正解率（％ 小数第1位）
- 合否（合格ライン含む）
- 採点日時（JST）
- attemptId

---

### 10.4 合格時のみ追加出力
```
---- 設問別結果（合格時のみ） ----
[Q001] 問題文：正解
[Q002] 問題文：不正解
...
```

- 各設問の **正解 / 不正解のみ**
- 正しい選択肢や解説文は出力しない
- 不合格時は設問別結果を出力しない

---

## 11. セキュリティ方針（ローカル前提）
- 平文の正解を置かない
- 採点キーはSVのみが知る
- 技術的完全防御ではなく、運用と抑止を重視

---

# 完成までにやるべき項目（TODO）

## フェーズ1：設計確定
- [x] 運用フロー確定
- [x] 採点方式確定（SVキー方式）
- [x] 結果TXT仕様確定
- [x] 出力内容（合格時の設問別正誤）確定

## フェーズ2：設問作成ツール
- [ ] 管理者UI設計
- [ ] 単一選択 / 複数選択の入力UI
- [ ] 採点キー入力UI
- [ ] 正解暗号化処理
- [ ] testpack.js 自動生成

## フェーズ3：受験・採点機能
- [ ] 受講者情報入力画面
- [ ] 問題表示（シャッフル対応）
- [ ] 回答ロック処理
- [ ] ENTERキーによる採点実行
- [ ] 正解率計算（小数第1位）
- [ ] 合否表示

## フェーズ4：結果出力
- [ ] TXT内容生成
- [ ] ファイル名サニタイズ
- [ ] ダウンロード処理実装（Blob + a.download）

## フェーズ5：品質確認
- [ ] file:// 起動確認
- [ ] CORSエラーが出ないことの確認
- [ ] 不合格時に詳細が出ないことの確認
- [ ] 日本語文字化け確認
- [ ] 再受験時の挙動確認

---

## 引き継ぎメモ
- 次スレッドでは **testpack.js の具体フォーマット定義**から再開
- 暗号方式の最終決定（CryptoJS / Web Crypto API 等）も次スレッドで行う
