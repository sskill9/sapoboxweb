# CSV 文字コード判定＆変換ツール 仕様書

本ツールは、Salesforce / ServiceNow / Amazon Connect などから出力された
CSV ファイルを読み込み、文字コードを判定し、必要に応じて
UTF-8（BOMあり/なし）または Shift_JIS に変換することを目的とした
ローカル動作の Web ツールです。

メモ帳で開いて「別名で保存 → 文字コードを選ぶ」作業を
できる限り少ないクリックで置き換えることを目指します。

---

## 📌 目的

- CSV の文字コードを正確に判定する  
- Excel で文字化けしない形式をユーザーが選択できるようにする  
- 「手動でメモ帳保存」を不要にし、作業時間を削減する  
- Salesforce / ServiceNow / Amazon Connect の CSV に対応  
- オフライン（ローカル）動作で CORS を回避する

---

## 📁 入力仕様

### ✔ 対応する入力方法
- **ドラッグ＆ドロップで読み込む（D&Dした瞬間に即判定）**
- **ファイル選択ボタン（input type="file"）から選択**

### ✔ 同時読み込み
- 複数ファイルの追加読み込みに対応  
- 2回目以降も既存リストに追加される

### ✔ 対応ファイル
- CSV（拡張子が何であっても中身がテキストならOK）

---

## 🧪 判定処理の流れ

1. D&D またはファイル選択で `File` を取得
2. `FileReader` または `Blob.text()` で中身を読み込む  
   → CORS は発生しない
3. 判定ロジックに通し、以下の3分類に分ける

---

## 🟢 A. 判定できた（正常判定）

### 条件
- 文字コードが 1 つに特定できる（UTF-8 / UTF-8(BOM) / Shift_JIS）
- CSV として行数・列数が概ね成立している

### 表示文言
```
◯◯として読み取れました
```

### 変換候補ボタン
- UTF-8（BOMなし）
- UTF-8（BOMあり）
- Shift_JIS

---

## 🔴 B. 判定できない（非テキスト）

### 条件
- バイナリや Excelブック、PDF、画像など  
- テキストとして読み取れない

### 表示文言
```
テキストとして読み取れませんでした
```

### 変換ボタン
- なし

---

## 🟡 C. 判定できない（曖昧だがテキストは読める）

### 条件
- UTF-8 や Shift_JIS など複数候補があり特定できない
- 一部文字化けするがテキスト解析は可能

### 表示文言
```
文字コードを特定できませんでした
```

### 変換候補ボタン
- UTF-8 として試す
- Shift_JIS として試す

---

## ✏ 判定中のステータス
```
判定中…
```

---

## 📊 出力（変換）仕様

### ✔ 変換候補
- UTF-8（BOMなし）
- UTF-8（BOMあり）
- Shift_JIS（CP932）

### ✔ プレフィックス方式（ファイル名の冒頭に付与）

| 変換先 | プレフィックス | 出力例 |
|--------|----------------|---------|
| UTF-8（BOMなし） | `UTF8_` | `UTF8_sample.csv` |
| UTF-8（BOMあり） | `UTF8BOM_` | `UTF8BOM_sample.csv` |
| Shift_JIS | `SJIS_` | `SJIS_sample.csv` |

元ファイル名はそのまま使用し、拡張子は追加しない。

---

## 🧱 一覧テーブル（結果表示）の列構成

| 列名 | 内容 |
|------|------|
| **ファイル名** | `file.name` |
| **判定結果** | UTF-8 / SJIS / 曖昧 / 非テキスト |
| **行数・列数** | 読み取れた場合のみ表示 |
| **変換** | 各種変換ボタン |

レスポンシブ対応：  
スマホでは横スクロール可能になるよう `<div class="table-responsive">` を使う。

---

## 📥 ドラッグ＆ドロップエリアの文言

```
ドラッグ＆ドロップ または 下のボタンから選択
```

---

## ⚠ 注意事項（ページ下部に常時表示）

```
※ 本ツールは CSV の文字コードを診断し、
　必要に応じて UTF-8 / UTF-8(BOM) / Shift_JIS に変換します。
　データ内容（数値 / 日付 / Excel のシリアル値など）は変更しません。
　「メモ帳で開いて文字コードを指定して保存し直す」作業を簡略化するためのツールです。
```

---

## 🔐 CORSについて

本ツールはドラッグ＆ドロップおよび  
`FileReader` / `Blob.text()` を使用するため  
**CORS違反は発生しません。**

---

## 📱 スマホ対応

- スマホでも全機能動作する  
- ただし D&D は無効（ボタン選択のみ有効）  
- 変換ボタンはスマホでは縦並びでも可  
- Bootstrap によるレスポンシブ対応が前提
