# T009 入電・応答（ざっくり）実装前・変更宣言（ブロック単位）

作成日：2025-12-20 (JST)

---

## 0. この文書の目的
- スレッド移動時に「経緯」と「変更範囲」を一括で持ち運べるようにする。
- ブロック単位で差し替え可能な形にするため、変更対象ファイルと差し替えブロックを固定する。
- この文書自体はコード生成ではなく、コード生成の前提条件（宣言）である。

---

## 1. ここまでの経緯まとめ（仕様確定）

### 1-1. ツール概要
- ツール：**T009 入電・応答（ざっくり）**
- 利用想定：**PCのみ（スマホ想定なし）**
- 画面：**2カラム（左：入力 / 右：結果）**

### 1-2. 入力（確定）
- 現在までの入電数 `C_now`
- 現在までの応答数 `A_now`
- 残り時間 `T_remain`（0.5刻み）
- 業務終了までの入電見込み（最終累計）`C_end`
- アサイン人数 `N_agent`（**0〜50**）
- 平均CPH `CPH`
- 目標応答率 `R_target_pct`（任意）

### 1-3. 出力（確定）
- 現在までの応答率（小数1桁・四捨五入、0割は0.0%）
- 業務終了までの予測応答数（件数は四捨五入）
- 業務終了までの予測応答率（小数1桁・四捨五入、0割は0.0%）
- 補助：残り入電、残り処理能力、余力/不足

### 1-4. バリデーション（確定）
- **E1** `A_now > C_now` は計算停止（結果は非表示/グレー）
- **W1** `C_end < C_now` は警告＋残り入電0扱いで計算継続

### 1-5. 目標応答率の危険度表示（確定：案A）
- 結果パネル全体：S1/S2/S3ならオレンジ背景
- 現在/未来の違いは**バッジ文言**で区別（OK/注意/危険）

### 1-6. 実装方針（確定）
- `content.js` を主に書き換え（UI＋イベント）
- 計算ロジックは分割して `tool.js` に集約（`content.js` 500行超え回避）
- `top.js` はツール名とDLリンクの文字列差し替え
- `modal-howto.js` / `modal-changelog.js` は文章差し替え
- `footer.js` / `modal-terms.js` 等は触らない
- Download_zip.bat はローカル専用のため作業対象外

### 1-7. 追加ルール（確定）
- ブロック終端コメントは必ず **「ここまで」** を明言する。
  - JS：`// ===== ○○ブロックここまで =====`
  - HTML：`<!-- ===== ○○ブロックここまで ===== -->`

---

## 2. 変更対象ファイル宣言（確定）

### 2-1. 変更する
1) `T009index.html`  
2) `top.js`  
3) `content.js`  
4) `modal-howto.js`  
5) `modal-changelog.js`  

### 2-2. 追加する（分割）
6) `tool.js`（新規追加）

### 2-3. 原則変更しない（今回は触らない）
- `footer.js`（共通フッター）
- `modal-terms.js`（共通利用規約）
- `modal-links.js`（今回は無改変）
- `favicon.svg` / `libs/bootstrap-5.3.8-dist/*`

---

## 3. 差し替えブロック宣言（ここまでコメント付き）

### 3-1. `T009index.html`（最小変更）
差し替え対象ブロック：
- `<!-- ===== T009HEADメタ情報ブロック ===== -->`
  - `<title>` と `<meta name="description">` をT009用に変更
- `<!-- ===== T009HEADメタ情報ブロックここまで ===== -->`

- `<!-- ===== T009スクリプト読込ブロック ===== -->`
  - `<script src="./tool.js"></script>` を追加
  - 追加位置は `top.js` の後、`content.js` の前
- `<!-- ===== T009スクリプト読込ブロックここまで ===== -->`

### 3-2. `top.js`（文言差し替えのみ）
差し替え対象ブロック：
- `// ===== T009ツール名表示ブロック =====`
  - PC用ツール名表示（1箇所）
  - スマホ用ツール名表示（1箇所）
- `// ===== T009ツール名表示ブロックここまで =====`

- `// ===== T009ダウンロードリンクブロック =====`
  - zipパス文字列のみ差し替え（構造は維持）
- `// ===== T009ダウンロードリンクブロックここまで =====`

### 3-3. `content.js`（UI担当）
差し替え対象ブロック：
- `// ===== T009コンテンツHTMLブロック =====`
  - `contentEl.innerHTML = \`...\`` の中身をT009用UIに置換
  - 2カラム構造（row + col-md-6）は維持
  - 入力エリア／結果エリアのIDを確定して埋め込む
- `// ===== T009コンテンツHTMLブロックここまで =====`

- `// ===== T009イベント登録ブロック =====`
  - `input/change` で `tool.js` の計算関数を呼び、結果を描画更新
  - エラー/警告メッセージ表示の更新も反映
- `// ===== T009イベント登録ブロックここまで =====`

維持（原則そのまま）ブロック：
- `// ===== TOPへ戻るボタンブロック =====`
  - 既存の `#backToTopBtn` DOM と挙動は維持
- `// ===== TOPへ戻るボタンブロックここまで =====`

### 3-4. `tool.js`（新規追加：ロジック担当）
収録ブロック（固定）：
- `// ===== T009入力正規化ブロック =====`
- `// ===== T009入力正規化ブロックここまで =====`

- `// ===== T009バリデーションブロック =====`
- `// ===== T009バリデーションブロックここまで =====`

- `// ===== T009計算ブロック =====`
- `// ===== T009計算ブロックここまで =====`

- `// ===== T009目標判定ブロック =====`
- `// ===== T009目標判定ブロックここまで =====`

- `// ===== T009公開APIブロック =====`
- `// ===== T009公開APIブロックここまで =====`

### 3-5. `modal-howto.js`（文章差し替え）
差し替え対象ブロック：
- `// ===== T009使い方本文ブロック =====`
  - タイトル、手順、注意（E1/W1）、ターゲット判定（案A）の説明
- `// ===== T009使い方本文ブロックここまで =====`

### 3-6. `modal-changelog.js`（履歴差し替え）
差し替え対象ブロック：
- `// ===== T009更新履歴本文ブロック =====`
  - v1.0.0 初版（入電/応答・目標応答率判定）
- `// ===== T009更新履歴本文ブロックここまで =====`

---

## 4. UIのID命名（確定：実装で固定して使用）

### 4-1. 入力
- `t009_calls_now`（入電数）
- `t009_answers_now`（応答数）
- `t009_target_rate`（目標応答率 %）
- `t009_remain_hours`（残り時間）
- `t009_calls_end`（終了まで入電見込み：最終累計）
- `t009_agents`（0〜50）
- `t009_cph`（平均CPH）

### 4-2. 結果
- `t009_result_panel`（背景オレンジ適用先）
- `t009_status_badge`（OK/注意/危険）
- `t009_msg_area`（E1/W1表示）
- `t009_rate_now`（現在応答率）
- `t009_answers_end`（終了予測応答数）
- `t009_rate_end`（終了予測応答率）

---

## 5. 次スレッドでの作業手順（コード生成フェーズ）
1) 次スレッドで、同じファイル一式を添付し直す（そのスレッドの添付を唯一の正とする）。
2) ユーザーが「生成OK」を出したら、以下を全文生成する。
   - `T009index.html`
   - `top.js`
   - `content.js`
   - `tool.js`（新規）
   - `modal-howto.js`
   - `modal-changelog.js`

以上。
